## 小程序第八天

### 复习

#### 1.0 昨日内容

+ 小程序前置知识
  + 数据缓存
    + 异步
    + 同步
      + sync
      + 存储
      + 取值
      + 清除
  + set 去重
+ 搜索页面：
  + 功能：
    + 联想功能：
      + 性能优化：js 的抖动
        +  防抖：
          + 持续触发，不会执行。停止一段时间之后再执行。
        + 节流
          + 持续触发，在固定的时间段内会执行一次。

#### 2.0 今日内容

+ 小程序中的生命周期
+ 购物车
  + 逻辑比较复杂的一个页面。

### 补充知识点

#### 3.0 小程序生命周期

+ 对比：
  + vue 的生命周期：
    + 认真看图片：[https://cn.vuejs.org/v2/guide/instance.html](https://cn.vuejs.org/v2/guide/instance.html)
  + 小程序中也有生命周期：
    + 分类：
      + 小程序的生命周期
      + 页面的生命周期

- App
  - onLaunch
    - 在小程序第一次被开启时执行
  - onShow
    - 在小程序显示&切前台时执行
  - onHide
    - 在小程序切后台时执行
- Page
  - onLoad  *
    - 当页面被加载时执行
  - onReady
    - 当页面初次渲染时执行
  - onShow *
    - 当页面显示&切前台时执行
  - onHide
    - 当页面切后台进执行
  - onUnload *
    - 当页面卸载(关闭)时执行
- 页面跳转的方法：
  - wx.navigateTo
    - 跳转到另一个页面，将当前页面保存到页面栈中，最多保存十份
  - wx.redirectTo
    - 跳转到另一个页面，将当前页面关闭
  - wx.swtichTab
    - 跳转到tab页面，关闭所有的非 tab 页面

#### 4.0 场景值

+ 概念：
  + 进入小程序的方式
+ 取得场景值
  +  在 app 中的 onLaunch & onShow 中通过 event.scene 来得到
+ 应用：
  + 拉新
  + 统计小程序进入的方式
  + .....

### 购物车：

#### 5.0 完成页面

- 完成静态页面
  - 设置页面的入口
  - 创建页面
  - 结构&样式
- 完成功能
  - 1）动态获取购物车中的收获地址
    - 思路：
      - 直接从微信中读取已经设置好的地址
    - 步骤：
      - a. 给请求选择地址添加一个点击事件
      - b. 在事件中选择微信中的收货地址：
        - wx.chooseAddress
      - c. 将选择的地址进行保存
      - d. 将数据渲染到页面上
  - 2）将收获地址缓存到本地
    - 步骤：
      - a. 获取收货地址之后，需要将数据通过 storage 进行保存
      - b. 每次打开页面时需要判断是否有收货地址
  - 3）完成详情页面的加入购物车功能
    - 步骤：
      - a. 在商品详情页面中给加入购物车添加一个事件
      - b. 在事件中得到商品信息
      - c. 将商品信息保存到 storage 中
        - 1.0 创建一个空的数组
        - 2.0 将点击后的商品信息保存到数组中
        - 3.0 将数组缓存到 storage
      - d. 添加成功后，提示加入成功
    - bug:
      - 每次刷新之后打开页面，再加入购物车会将之前的数据进行清除。
      - 原因：
        - 每次刷新之后，数据源重置为空了
        - 再次加入时，会向空的数组中加入内容
        - 再次保存，保存的新的数组
        - 每个刷新后的数据，跟之前的数据不是同一个
      - 解决方案：
        - 当每次打开页面时，重新从 storage 中获取数据
  - 4）优化购物车中的数据结构
    - 步骤：
      - a. 将商品详情中的 goodsList 由数组改为对象
      - b. 在向 goodsList 中添加数据时，判断是否已经有了数据
  - 5）打开购物车时动态获取数据并渲染
    - 步骤：
      - a. 打开页面时，要获取 storage 中的 cart
      - b. 将数据动态渲染到页面上
    - bug:
      - 渲染数据之后，再次向购物车中添加内容，数据不更新
      - 原因：
        - 在 mounted 中请求的 storage 中的数据
        - mounted 在页面开启时执行一次，就不执行了
      - 解决方案：
        - 将请求的 storage 中的数据放到 onShow 中
  - 6）计算商品总价
    - 步骤：
      - a. 在计算属性中添加一个属性： totalPrice
      - b. 通过遍历goodsList 数据源中的数据，得到商品的总价
      - c. 将价格渲染到页面上
  - 7）设置商品状态
    - 步骤：
      - a. 动态向商品的数据源中添加一个状态属性
      - b. 给状态按钮设置点击事件
      - c. 点击完成之后修改商品的状态
      - d. 根据商品的状态来设置商品的总价
  - 8）设置商品数量
    - 步骤：
      - a. 给数量添加两个修改的按钮（+ ，-）
      - b. 分别设置点击事件
        -  \+ ： 
          - 让数量 ++
          - 将数据同步到 storage 中
        - \-：
          - 让数量 --
          - 将数据同步到 sotrage 中
      - c. 根据商品的数量来计算总价
    - bug：
      - 数量小于0
      - 解决方案：
        - 当数据一旦小于等于0时，我们需要将当前商品数据删除
  - 9）计算商品总数
    - 步骤：
      - a. 添加一个计算属性 totalnum
      - b. totalnum 由选中商品的数量来决定