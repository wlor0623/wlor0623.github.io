## 小程序第六天

### 概览

#### 1.0 昨天内容

+ 分类页面：

  + 结构&样式

  + 动态请求&渲染数据

    + 服务器返回的数据：

      ```
      [
        { cat_name: '大家电', 
          children: [
            {'cat_name': "电视", children: [
               { cat_name: '曲面电视', cat_icon: '' }
             ]} 
          ] 
        }
      ]
      ```

+ 搜索列表

  + 前置知识：
    + 下拉刷新
    + 上拉加载更多
  + 搜索列表：
    + 结构&样式
    + 动态获取&渲染数据
    + 上拉加载更多
      + 解决了相关的 bug
    + 下拉刷新
      + 解决了相关的 bug

#### 2.0 今日内容

+ 补充知识点：
  + 解决小程序中遗留的 bug
  + 关键字 @import 
+ 商品详情
  + 结构&样式
  + 动态渲染数据
  + 功能：
    + 预览图片
    + 使用 icon 图标
    + 在小程序中完成拨号



### 补充知识

#### 3.0 解决搜索列表&分类页面切换的 bug

+ bug 一：
  + 当分类中没有数据时，显示底线
+ bug 二：
  + 表现：
    + 第一次进入搜索列表时，可以正常获取数据
    + 如果点击返回
      - 再次进入搜索列表，会将上一次打开页面中的数据再次加载，不会更新数据
  + 原因：
    + 页面栈： wx.navigateTo()
      + 页面栈最多十层
    + 因为第一次请求页面时，小程序会将页面缓存到页面栈中，将来再次请求这个属性时，不会再加载一次页面，只会从页面栈将页面取出，并且渲染。所以数据不会更新
  + 解决方案：
    + 当离开页面时，将数据全部清空
      + 生命周期： 
        + onUnload:
          + 当页面被卸载时执行

#### 4.0 @import

+ 作用：可以导入其它样式文件

+ 语法： 

  ```
  @import './index.less';
  ```

+ 总结：

  + wxss 与 css 的区别
    + 1）wxss 中引入的新的单位： rpx
    + 2） app.wxss 是全局样式， page.wxss 是局部样式（在 css 不存在）
    + 3）wxss 只支持部分 css 选择器

#### 5.0 使用字体图标

+ 以前使用步骤：
  + 1.0 进入网站： 阿里巴巴图标库
  + 2.0 搜索自己想要的图标，加入购物车
  + 3.0 下载资源（登录）
  + 4.0 使用
+ 今日步骤：
  + 1.0 进入网站：iconfont
  + 2.0 搜索自己想要的图片，加入购物车
  + 3.0 添加到项目：
    + 创建一个项目
  + 4.0 生成在线链接
  + 5.0 复制内容到自己的项目中
  + 6.0 导入样式，并且使用

### 商品详情

#### 6.0 完成详情页面

+ 完成静态页面
  + 设置一个页面的入口
  + 创建一个页面
  + 结构
  + 样式

+ 完成数据操作
  + 动态获取数据
    + 步骤：
      + 1.0 接收上一个页面传递过来的 id
      + 2.0 根据 id 到服务器中得到商品数据
        + API：[https://autumnfish.cn/wx/api/public/v1/goods/detail?goods_id=542](https://autumnfish.cn/wx/api/public/v1/goods/detail?goods_id=542)
        + 方式：GET
        + 参数：
          + goods_id：商品对应的 id
  + 动态渲染数据

+ 补充功能

  + 预览图片

    + 1）给每张图片添加一个点击事件

    + 2）操作数据，生成一个图片的集合，调用一个 API

      ```
      wx.previewImage({
        current: '', // 当前显示图片的http链接
        urls: [] // 需要预览的图片列表
      })
      ```

      ​

  + 分享功能

    + 1）添加一个组件 button， 
      + 设置属性 open-type: share
    + 2）点击按钮会触发事件：
      + onShareAppMessage
        + 注意点：可以通过当前方法的返回值设置分享页面的结构：
          + title: 标题
          + imageUrl: 图片
          + path: 分享页面的路径
    + 3）将分享按钮隐藏起来

  + 联系客服

    + 1）添加一个组件： button
      + 设置属性： open-type:  contact
    + 2）点击按钮，它会打开一个聊天对话框

### 商品搜索

#### 7.0 完成搜索页面







































